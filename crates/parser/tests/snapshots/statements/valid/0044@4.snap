---
source: crates/parser/tests/statement_parser_test.rs
description: "\nCREATE VIEW comedies AS SELECT f.*, country_code_to_name(f.country_code) AS country, (SELECT avg(r.rating) FROM user_ratings r WHERE r.film_id = f.id) AS avg_rating FROM films f WHERE f.kind = 'Comedy';"
---
Parse {
    cst: SourceFile@0..203
      Newline@0..1 "\n"
      ViewStmt@1..203
        Create@1..7 "CREATE"
        Whitespace@7..8 " "
        View@8..12 "VIEW"
        Whitespace@12..13 " "
        RangeVar@13..21
          Ident@13..21 "comedies"
        Whitespace@21..22 " "
        As@22..24 "AS"
        Whitespace@24..25 " "
        SelectStmt@25..202
          Select@25..31 "SELECT"
          Whitespace@31..32 " "
          ResTarget@32..35
            ColumnRef@32..35
              Ident@32..33 "f"
              Ascii46@33..34 "."
              AStar@34..35
                Ascii42@34..35 "*"
          Ascii44@35..36 ","
          Whitespace@36..37 " "
          ResTarget@37..84
            FuncCall@37..72
              Ident@37..57 "country_code_to_name"
              Ascii40@57..58 "("
              ColumnRef@58..72
                Ident@58..59 "f"
                Ascii46@59..60 "."
                Ident@60..72 "country_code"
            Ascii41@72..73 ")"
            Whitespace@73..74 " "
            As@74..76 "AS"
            Whitespace@76..77 " "
            Ident@77..84 "country"
          Ascii44@84..85 ","
          Whitespace@85..86 " "
          ResTarget@86..165
            SubLink@86..150
              SelectStmt@86..150
                Ascii40@86..87 "("
                Select@87..93 "SELECT"
                Whitespace@93..94 " "
                ResTarget@94..106
                  FuncCall@94..106
                    Ident@94..97 "avg"
                    Ascii40@97..98 "("
                    ColumnRef@98..106
                      Ident@98..99 "r"
                      Ascii46@99..100 "."
                      Ident@100..106 "rating"
                Ascii41@106..107 ")"
                Whitespace@107..108 " "
                From@108..112 "FROM"
                Whitespace@112..113 " "
                RangeVar@113..127
                  Ident@113..125 "user_ratings"
                  Whitespace@125..126 " "
                  Alias@126..127
                    Ident@126..127 "r"
                Whitespace@127..128 " "
                Where@128..133 "WHERE"
                Whitespace@133..134 " "
                AExpr@134..150
                  ColumnRef@134..143
                    Ident@134..135 "r"
                    Ascii46@135..136 "."
                    Ident@136..143 "film_id"
                  Whitespace@143..144 " "
                  Ascii61@144..145 "="
                  Whitespace@145..146 " "
                  ColumnRef@146..150
                    Ident@146..147 "f"
                    Ascii46@147..148 "."
                    Ident@148..150 "id"
            Ascii41@150..151 ")"
            Whitespace@151..152 " "
            As@152..154 "AS"
            Whitespace@154..155 " "
            Ident@155..165 "avg_rating"
          Whitespace@165..166 " "
          From@166..170 "FROM"
          Whitespace@170..171 " "
          RangeVar@171..178
            Ident@171..176 "films"
            Whitespace@176..177 " "
            Alias@177..178
              Ident@177..178 "f"
          Whitespace@178..179 " "
          Where@179..184 "WHERE"
          Whitespace@184..185 " "
          AExpr@185..202
            ColumnRef@185..191
              Ident@185..186 "f"
              Ascii46@186..187 "."
              Ident@187..191 "kind"
            Whitespace@191..192 " "
            Ascii61@192..193 "="
            Whitespace@193..194 " "
            AConst@194..202
              Sconst@194..202 "'Comedy'"
        Ascii59@202..203 ";"
    ,
    errors: [],
    stmts: [
        RawStmt {
            stmt: ViewStmt(
                ViewStmt {
                    view: Some(
                        RangeVar {
                            catalogname: "",
                            schemaname: "",
                            relname: "comedies",
                            inh: true,
                            relpersistence: "p",
                            alias: None,
                            location: 12,
                        },
                    ),
                    aliases: [],
                    query: Some(
                        Node {
                            node: Some(
                                SelectStmt(
                                    SelectStmt {
                                        distinct_clause: [],
                                        into_clause: None,
                                        target_list: [
                                            Node {
                                                node: Some(
                                                    ResTarget(
                                                        ResTarget {
                                                            name: "",
                                                            indirection: [],
                                                            val: Some(
                                                                Node {
                                                                    node: Some(
                                                                        ColumnRef(
                                                                            ColumnRef {
                                                                                fields: [
                                                                                    Node {
                                                                                        node: Some(
                                                                                            String(
                                                                                                String {
                                                                                                    sval: "f",
                                                                                                },
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                    Node {
                                                                                        node: Some(
                                                                                            AStar(
                                                                                                AStar,
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                ],
                                                                                location: 31,
                                                                            },
                                                                        ),
                                                                    ),
                                                                },
                                                            ),
                                                            location: 31,
                                                        },
                                                    ),
                                                ),
                                            },
                                            Node {
                                                node: Some(
                                                    ResTarget(
                                                        ResTarget {
                                                            name: "country",
                                                            indirection: [],
                                                            val: Some(
                                                                Node {
                                                                    node: Some(
                                                                        FuncCall(
                                                                            FuncCall {
                                                                                funcname: [
                                                                                    Node {
                                                                                        node: Some(
                                                                                            String(
                                                                                                String {
                                                                                                    sval: "country_code_to_name",
                                                                                                },
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                ],
                                                                                args: [
                                                                                    Node {
                                                                                        node: Some(
                                                                                            ColumnRef(
                                                                                                ColumnRef {
                                                                                                    fields: [
                                                                                                        Node {
                                                                                                            node: Some(
                                                                                                                String(
                                                                                                                    String {
                                                                                                                        sval: "f",
                                                                                                                    },
                                                                                                                ),
                                                                                                            ),
                                                                                                        },
                                                                                                        Node {
                                                                                                            node: Some(
                                                                                                                String(
                                                                                                                    String {
                                                                                                                        sval: "country_code",
                                                                                                                    },
                                                                                                                ),
                                                                                                            ),
                                                                                                        },
                                                                                                    ],
                                                                                                    location: 57,
                                                                                                },
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                ],
                                                                                agg_order: [],
                                                                                agg_filter: None,
                                                                                over: None,
                                                                                agg_within_group: false,
                                                                                agg_star: false,
                                                                                agg_distinct: false,
                                                                                func_variadic: false,
                                                                                funcformat: CoerceExplicitCall,
                                                                                location: 36,
                                                                            },
                                                                        ),
                                                                    ),
                                                                },
                                                            ),
                                                            location: 36,
                                                        },
                                                    ),
                                                ),
                                            },
                                            Node {
                                                node: Some(
                                                    ResTarget(
                                                        ResTarget {
                                                            name: "avg_rating",
                                                            indirection: [],
                                                            val: Some(
                                                                Node {
                                                                    node: Some(
                                                                        SubLink(
                                                                            SubLink {
                                                                                xpr: None,
                                                                                sub_link_type: ExprSublink,
                                                                                sub_link_id: 0,
                                                                                testexpr: None,
                                                                                oper_name: [],
                                                                                subselect: Some(
                                                                                    Node {
                                                                                        node: Some(
                                                                                            SelectStmt(
                                                                                                SelectStmt {
                                                                                                    distinct_clause: [],
                                                                                                    into_clause: None,
                                                                                                    target_list: [
                                                                                                        Node {
                                                                                                            node: Some(
                                                                                                                ResTarget(
                                                                                                                    ResTarget {
                                                                                                                        name: "",
                                                                                                                        indirection: [],
                                                                                                                        val: Some(
                                                                                                                            Node {
                                                                                                                                node: Some(
                                                                                                                                    FuncCall(
                                                                                                                                        FuncCall {
                                                                                                                                            funcname: [
                                                                                                                                                Node {
                                                                                                                                                    node: Some(
                                                                                                                                                        String(
                                                                                                                                                            String {
                                                                                                                                                                sval: "avg",
                                                                                                                                                            },
                                                                                                                                                        ),
                                                                                                                                                    ),
                                                                                                                                                },
                                                                                                                                            ],
                                                                                                                                            args: [
                                                                                                                                                Node {
                                                                                                                                                    node: Some(
                                                                                                                                                        ColumnRef(
                                                                                                                                                            ColumnRef {
                                                                                                                                                                fields: [
                                                                                                                                                                    Node {
                                                                                                                                                                        node: Some(
                                                                                                                                                                            String(
                                                                                                                                                                                String {
                                                                                                                                                                                    sval: "r",
                                                                                                                                                                                },
                                                                                                                                                                            ),
                                                                                                                                                                        ),
                                                                                                                                                                    },
                                                                                                                                                                    Node {
                                                                                                                                                                        node: Some(
                                                                                                                                                                            String(
                                                                                                                                                                                String {
                                                                                                                                                                                    sval: "rating",
                                                                                                                                                                                },
                                                                                                                                                                            ),
                                                                                                                                                                        ),
                                                                                                                                                                    },
                                                                                                                                                                ],
                                                                                                                                                                location: 97,
                                                                                                                                                            },
                                                                                                                                                        ),
                                                                                                                                                    ),
                                                                                                                                                },
                                                                                                                                            ],
                                                                                                                                            agg_order: [],
                                                                                                                                            agg_filter: None,
                                                                                                                                            over: None,
                                                                                                                                            agg_within_group: false,
                                                                                                                                            agg_star: false,
                                                                                                                                            agg_distinct: false,
                                                                                                                                            func_variadic: false,
                                                                                                                                            funcformat: CoerceExplicitCall,
                                                                                                                                            location: 93,
                                                                                                                                        },
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                        location: 93,
                                                                                                                    },
                                                                                                                ),
                                                                                                            ),
                                                                                                        },
                                                                                                    ],
                                                                                                    from_clause: [
                                                                                                        Node {
                                                                                                            node: Some(
                                                                                                                RangeVar(
                                                                                                                    RangeVar {
                                                                                                                        catalogname: "",
                                                                                                                        schemaname: "",
                                                                                                                        relname: "user_ratings",
                                                                                                                        inh: true,
                                                                                                                        relpersistence: "p",
                                                                                                                        alias: Some(
                                                                                                                            Alias {
                                                                                                                                aliasname: "r",
                                                                                                                                colnames: [],
                                                                                                                            },
                                                                                                                        ),
                                                                                                                        location: 112,
                                                                                                                    },
                                                                                                                ),
                                                                                                            ),
                                                                                                        },
                                                                                                    ],
                                                                                                    where_clause: Some(
                                                                                                        Node {
                                                                                                            node: Some(
                                                                                                                AExpr(
                                                                                                                    AExpr {
                                                                                                                        kind: AexprOp,
                                                                                                                        name: [
                                                                                                                            Node {
                                                                                                                                node: Some(
                                                                                                                                    String(
                                                                                                                                        String {
                                                                                                                                            sval: "=",
                                                                                                                                        },
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ],
                                                                                                                        lexpr: Some(
                                                                                                                            Node {
                                                                                                                                node: Some(
                                                                                                                                    ColumnRef(
                                                                                                                                        ColumnRef {
                                                                                                                                            fields: [
                                                                                                                                                Node {
                                                                                                                                                    node: Some(
                                                                                                                                                        String(
                                                                                                                                                            String {
                                                                                                                                                                sval: "r",
                                                                                                                                                            },
                                                                                                                                                        ),
                                                                                                                                                    ),
                                                                                                                                                },
                                                                                                                                                Node {
                                                                                                                                                    node: Some(
                                                                                                                                                        String(
                                                                                                                                                            String {
                                                                                                                                                                sval: "film_id",
                                                                                                                                                            },
                                                                                                                                                        ),
                                                                                                                                                    ),
                                                                                                                                                },
                                                                                                                                            ],
                                                                                                                                            location: 133,
                                                                                                                                        },
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                        rexpr: Some(
                                                                                                                            Node {
                                                                                                                                node: Some(
                                                                                                                                    ColumnRef(
                                                                                                                                        ColumnRef {
                                                                                                                                            fields: [
                                                                                                                                                Node {
                                                                                                                                                    node: Some(
                                                                                                                                                        String(
                                                                                                                                                            String {
                                                                                                                                                                sval: "f",
                                                                                                                                                            },
                                                                                                                                                        ),
                                                                                                                                                    ),
                                                                                                                                                },
                                                                                                                                                Node {
                                                                                                                                                    node: Some(
                                                                                                                                                        String(
                                                                                                                                                            String {
                                                                                                                                                                sval: "id",
                                                                                                                                                            },
                                                                                                                                                        ),
                                                                                                                                                    ),
                                                                                                                                                },
                                                                                                                                            ],
                                                                                                                                            location: 145,
                                                                                                                                        },
                                                                                                                                    ),
                                                                                                                                ),
                                                                                                                            },
                                                                                                                        ),
                                                                                                                        location: 143,
                                                                                                                    },
                                                                                                                ),
                                                                                                            ),
                                                                                                        },
                                                                                                    ),
                                                                                                    group_clause: [],
                                                                                                    group_distinct: false,
                                                                                                    having_clause: None,
                                                                                                    window_clause: [],
                                                                                                    values_lists: [],
                                                                                                    sort_clause: [],
                                                                                                    limit_offset: None,
                                                                                                    limit_count: None,
                                                                                                    limit_option: Default,
                                                                                                    locking_clause: [],
                                                                                                    with_clause: None,
                                                                                                    op: SetopNone,
                                                                                                    all: false,
                                                                                                    larg: None,
                                                                                                    rarg: None,
                                                                                                },
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                ),
                                                                                location: 85,
                                                                            },
                                                                        ),
                                                                    ),
                                                                },
                                                            ),
                                                            location: 85,
                                                        },
                                                    ),
                                                ),
                                            },
                                        ],
                                        from_clause: [
                                            Node {
                                                node: Some(
                                                    RangeVar(
                                                        RangeVar {
                                                            catalogname: "",
                                                            schemaname: "",
                                                            relname: "films",
                                                            inh: true,
                                                            relpersistence: "p",
                                                            alias: Some(
                                                                Alias {
                                                                    aliasname: "f",
                                                                    colnames: [],
                                                                },
                                                            ),
                                                            location: 170,
                                                        },
                                                    ),
                                                ),
                                            },
                                        ],
                                        where_clause: Some(
                                            Node {
                                                node: Some(
                                                    AExpr(
                                                        AExpr {
                                                            kind: AexprOp,
                                                            name: [
                                                                Node {
                                                                    node: Some(
                                                                        String(
                                                                            String {
                                                                                sval: "=",
                                                                            },
                                                                        ),
                                                                    ),
                                                                },
                                                            ],
                                                            lexpr: Some(
                                                                Node {
                                                                    node: Some(
                                                                        ColumnRef(
                                                                            ColumnRef {
                                                                                fields: [
                                                                                    Node {
                                                                                        node: Some(
                                                                                            String(
                                                                                                String {
                                                                                                    sval: "f",
                                                                                                },
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                    Node {
                                                                                        node: Some(
                                                                                            String(
                                                                                                String {
                                                                                                    sval: "kind",
                                                                                                },
                                                                                            ),
                                                                                        ),
                                                                                    },
                                                                                ],
                                                                                location: 184,
                                                                            },
                                                                        ),
                                                                    ),
                                                                },
                                                            ),
                                                            rexpr: Some(
                                                                Node {
                                                                    node: Some(
                                                                        AConst(
                                                                            AConst {
                                                                                isnull: false,
                                                                                location: 193,
                                                                                val: Some(
                                                                                    Sval(
                                                                                        String {
                                                                                            sval: "Comedy",
                                                                                        },
                                                                                    ),
                                                                                ),
                                                                            },
                                                                        ),
                                                                    ),
                                                                },
                                                            ),
                                                            location: 191,
                                                        },
                                                    ),
                                                ),
                                            },
                                        ),
                                        group_clause: [],
                                        group_distinct: false,
                                        having_clause: None,
                                        window_clause: [],
                                        values_lists: [],
                                        sort_clause: [],
                                        limit_offset: None,
                                        limit_count: None,
                                        limit_option: Default,
                                        locking_clause: [],
                                        with_clause: None,
                                        op: SetopNone,
                                        all: false,
                                        larg: None,
                                        rarg: None,
                                    },
                                ),
                            ),
                        },
                    ),
                    replace: false,
                    options: [],
                    with_check_option: NoCheckOption,
                },
            ),
            range: 0..202,
        },
    ],
}
